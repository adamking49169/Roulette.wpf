<controls:MetroWindow x:Class="Roulette.Wpf.Views.RouletteWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:viewModels="clr-namespace:Roulette.Wpf.ViewModels"
    xmlns:conv="clr-namespace:Roulette.Wpf.Converters"
    Title="Roulette" Width="980" Height="640" WindowStartupLocation="CenterScreen">

    <!-- ViewModel -->
    <controls:MetroWindow.DataContext>
        <viewModels:GameViewModel/>
    </controls:MetroWindow.DataContext>

    <!-- Resources -->
    <controls:MetroWindow.Resources>
        <conv:SpinColorToBrushConverter x:Key="SpinColorToBrushConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="8"/>
        </Style>
    </controls:MetroWindow.Resources>

    <!-- Layout -->
    <Grid Background="#F4F6F8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="360"/>
            <ColumnDefinition Width="10"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <TextBlock Grid.ColumnSpan="3"
                   Text="European Roulette"
                   FontSize="20" FontWeight="SemiBold"
                   Margin="12,8,12,0"/>

        <!-- ===== Left: Bet panel ===== -->
        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="Add Bet" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                    <TextBlock Text="Type" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding BetTypes}"
                              SelectedItem="{Binding SelectedBetType}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                    <TextBlock Text="Stake" Width="90" VerticalAlignment="Center"/>
                    <TextBox Width="220"
                             Text="{Binding Stake, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Conditional fields -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowStraight, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Number" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding Numbers}"
                              SelectedItem="{Binding StraightNumber}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowRB, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Red/Black" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding RBOptions}"
                              SelectedItem="{Binding SelectedRB}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowEO, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Even/Odd" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding EOOptions}"
                              SelectedItem="{Binding SelectedEO}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowLH, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Low/High" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding LHOptions}"
                              SelectedItem="{Binding SelectedLH}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowDozen, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Dozen" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding Dozens}"
                              SelectedItem="{Binding SelectedDozen}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,6"
                            Visibility="{Binding ShowColumn, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Column" Width="90" VerticalAlignment="Center"/>
                    <ComboBox Width="220"
                              ItemsSource="{Binding Columns}"
                              SelectedItem="{Binding SelectedColumn}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <Button Content="Add Bet" Width="120" Margin="0,0,8,0"
                            IsEnabled="{Binding CanAddBet}"
                            Command="{Binding AddBetCommand}"/>
                    <Button Content="Clear" Width="90"
                            Command="{Binding ClearBetsCommand}"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- ===== Right: Bet list & Spin ===== -->
        <StackPanel Grid.Row="1" Grid.Column="2">
            <!-- Bet list -->
            <Border Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Current Bets" FontWeight="SemiBold" FontSize="14"/>
                    <ListView ItemsSource="{Binding Bets}"
                              Margin="0,8,0,0"
                              Height="220"
                              SelectedItem="{Binding SelectedBet}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Type"   Width="120" DisplayMemberBinding="{Binding Type}"/>
                                <GridViewColumn Header="Details" Width="240" DisplayMemberBinding="{Binding Description}"/>
                                <GridViewColumn Header="Stake"   Width="80"  DisplayMemberBinding="{Binding Stake}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- Result + Spin -->
            <Border Style="{StaticResource Card}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="200"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Result" FontWeight="SemiBold" FontSize="14"/>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Border Width="72" Height="72" CornerRadius="36"
                                    Background="{Binding LastSpinColor, Converter={StaticResource SpinColorToBrushConverter}}">
                                <TextBlock Text="{Binding LastSpinNumber}"
                                           VerticalAlignment="Center" HorizontalAlignment="Center"
                                           FontSize="20" FontWeight="Bold" Foreground="White"/>
                            </Border>
                            <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock Text="{Binding LastSpinLabel}" FontSize="14"/>
                                <TextBlock Text="{Binding LastNetResult, StringFormat=Net: {0:+#;-#;0}}"
                                           FontSize="16" FontWeight="SemiBold"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button Content="Spin" Width="160" Height="44"
                                Command="{Binding SpinCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </StackPanel>
    </Grid>
</controls:MetroWindow>
